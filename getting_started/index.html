<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"> 
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>Marten - Getting Started</title>
		<link href="/marten/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="/marten/content/prism.css" rel="stylesheet" type="text/css" />
		<link href="/marten/content/theme.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
        

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">


        <!-- CSS code from Bootply.com editor -->
        <link href="/marten/content/affix.css" rel="stylesheet" type="text/css" />
    </head>
    
    <!-- HTML code from Bootply.com editor -->
    
    <body  >

<a href="https://github.com/jasperfx/marten"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
        
        <nav class="navbar navbar-default navbar-fixed-top" role="banner">
		  <div class="container">
		    <div class="navbar-header">
		      <a href="/marten" class="navbar-brand">Marten 2.10.0</a>
		    </div>
		    <nav class="collapse navbar-collapse" role="navigation">
		      <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/marten/getting_started">Getting Started</a>
            </li>
		        <li>
		          <a href="/marten/documentation">Documentation</a>
		        </li>
		        <li>
<a href="https://gitter.im/jasperfx/marten?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/marten" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
		        </li>
		      	<li><a href="/marten/" title="Marten">Previous</a></li>
		      	<li><a href="/marten/documentation" title="Documentation">Next</a></li>
		      </ul>
      <div class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input id="search" type="search" class="form-control" placeholder="Search">
        </div>
      </div>

		    </nav>

		  </div>
		</nav>

		  <div class="container">
		  	<nav class="navbar-inverse">
		  		<ol class="breadcrumb"><li><a href="/marten/">Marten</a></li><li class="active">Getting Started</li></ol>
		  	</nav>
		  </div>

		<!--main-->
		<div class="container">
			<div class="row">
		      <!--left-->
		      
		      <div class="col-md-3" id="leftCol">
			  
				<img src="http://jasperfx.github.io/marten/content/images/emblem.png" width="80%" align="middle"/>
		      	<br />

				<ul class="nav nav-stacked affix" id="sidebar">

		        </ul>

		        	<h3 class="no-margin">Next</h3><p><a href="/marten/documentation">Documentation</a></p>
		        	<h3 class="no-margin">Previous</h3><a href="/marten/">Marten</a></p>

		        </ul>
		      </div><!--/left-->
		      
		      <!--right-->
		      <div class="col-md-9">
			      	<h1>Getting Started <a href="https://github.com/jasperfx/marten/blob/master/documentation/getting_started.md"  class="text-muted small pull-right fa fa-github" style="margin-top: 10px"> Edit on GitHub</a></h1>
			      
			      	<hr />

			      	<div id="main-pane">
			      		<!--Title:Getting Started-->
<!--Url:getting_started-->
<p>First, go get the Marten library from Nuget:</p>
<pre>
PM> Install-Package Marten
</pre>
<p>Or, using paket:</p>
<pre>
paket add nuget Marten
</pre>
<p>The next step is to get access to a PostgreSQL <strong>9.5+</strong> database schema. If you want to let Marten build database schema objects on the fly at development time,
make sure that your user account has rights to execute <code>CREATE TABLE/FUNCTION</code> statements.</p>
<p>Marten uses the <a href="http://www.npgsql.org">Npgsql</a> library to access PostgreSQL from .NET, so you'll likely want to read their <a href="http://www.npgsql.org/doc/connection-string-parameters.html">documentation on connection string syntax</a>.</p>
<h2 id="bootstrapping-a-document-store">Bootstrapping a Document Store</h2>
<p>To start up Marten in a running application, you need to create a single <code>IDocumentStore</code> object. The quickest way is to start with
all the default behavior and a connection string:</p>
<pre><code class="language-csharp">&#xA;var store = DocumentStore&#xA;    .For(&quot;host=localhost;database=marten_test;password=mypassword;username=someuser&quot;);&#xA;</code></pre>
<p>Now, for your first document type, let's represent the users in our system:</p>
<pre><code class="language-csharp">&#xA;public class User&#xA;{&#xA;    public Guid Id { get; set; }&#xA;    public string FirstName { get; set; }&#xA;    public string LastName { get; set; }&#xA;    public bool Internal { get; set; }&#xA;    public string UserName { get; set; }&#xA;}&#xA;</code></pre>
<p><em>For more information on document id's, see <a href="/marten/documentation/documents/identity">Document Identity</a>.</em></p>
<p>And now that we've got a PostgreSQL schema and an <code>IDocumentStore</code>, let's start persisting and loading user documents:</p>
<pre><code class="language-csharp">&#xA;// Open a session for querying, loading, and &#xA;// updating documents &#xA;using (var session = store.LightweightSession())&#xA;{&#xA;    var user = new User {FirstName = &quot;Han&quot;, LastName = &quot;Solo&quot;};&#xA;    session.Store(user);&#xA;&#xA;    session.SaveChanges();&#xA;}&#xA;&#xA;// Open a session for querying, loading, and &#xA;// updating documents with a backing &quot;Identity Map&quot;&#xA;using (var session = store.OpenSession())&#xA;{&#xA;    var existing = session&#xA;        .Query&lt;User&gt;()&#xA;        .Where(x =&gt; x.FirstName == &quot;Han&quot; &amp;&amp; x.LastName == &quot;Solo&quot;)&#xA;        .Single();&#xA;}&#xA;&#xA;// Open a session for querying, loading, and &#xA;// updating documents that performas automated&#xA;// &quot;dirty&quot; checking of previously loaded documents&#xA;using (var session = store.DirtyTrackedSession())&#xA;{&#xA;    &#xA;}&#xA;</code></pre>
<h2 id="integrating-marten-with-ioc-containers">Integrating Marten with IoC Containers</h2>
<p>The Marten team has striven to make the library perfectly usable without the usage of an IoC container, but you may still want to
use an IoC container specifically to manage dependencies and the life cycle of Marten objects.</p>
<p>Using <a href="http://structuremap.github.io">StructureMap</a> as the example container, we recommend registering Marten something like this:</p>
<pre><code class="language-csharp">&#xA;public class MartenServices : Registry&#xA;{&#xA;    public MartenServices()&#xA;    {&#xA;        ForSingletonOf&lt;IDocumentStore&gt;().Use(&quot;Build the DocumentStore&quot;, () =&gt;&#xA;        {&#xA;            return DocumentStore.For(_ =&gt;&#xA;            {&#xA;                _.Connection(&quot;your connection string&quot;);&#xA;                _.AutoCreateSchemaObjects = AutoCreate.None;&#xA;                &#xA;                // other Marten configuration options&#xA;            });&#xA;        });&#xA;&#xA;        For&lt;IDocumentSession&gt;()&#xA;            .LifecycleIs&lt;ContainerLifecycle&gt;() // not really necessary in some frameworks&#xA;            .Use(&quot;Lightweight Session&quot;, c =&gt; c.GetInstance&lt;IDocumentStore&gt;().LightweightSession());&#xA;    }&#xA;}&#xA;</code></pre>
<p>There are really only two key points here:</p>
<ol>
<li>There should only be one <code>IDocumentStore</code> object instance created in your application, so I scoped it as a &quot;Singleton&quot; in the StructureMap container</li>
<li>The <code>IDocumentSession</code> service that you use to read and write documents should be scoped as &quot;one per transaction.&quot; In typical usage, this
ends up meaning that an <code>IDocumentSession</code> should be scoped to a single HTTP request in web applications or a single message being handled in service
bus applications.</li>
</ol>
<p>There's a lot more capabilities than what we're showing here, so head on over to <a href="/marten/documentation">Documentation</a> to see what else Marten offers.</p>
<h2 id="using-marten-to-create-databases">Using Marten to create databases</h2>
<p>Marten can be configured to create (or drop &amp; create) databases in case they do not exist. This is done via store options, through <code>StoreOptions.CreateDatabasesForTenants</code>.</p>
<pre><code class="language-csharp">&#xA;storeOptions.CreateDatabasesForTenants(c =&gt;&#xA;{&#xA;    // Specify a db to which to connect in case database needs to be created.&#xA;    // If not specified, defaults to &#x27;postgres&#x27; on the connection for a tenant.&#xA;    c.MaintenanceDatabase(cstring);&#xA;    c.ForTenant()&#xA;        .CheckAgainstPgDatabase()&#xA;        .WithOwner(&quot;postgres&quot;)&#xA;        .WithEncoding(&quot;UTF-8&quot;)&#xA;        .ConnectionLimit(-1)&#xA;        .OnDatabaseCreated(_ =&gt;&#xA;        {&#xA;            dbCreated = true;&#xA;        });&#xA;});&#xA;</code></pre>
<p>Databases are checked for existence upon store initialization. By default, connection attempts are made against the databases specified for tenants. If a connection attempt results in an invalid catalog error (3D000), database creation is triggered. <code>ITenantDatabaseCreationExpressions.CheckAgainstPgDatabase</code> can be used to alter this behaviour to check for database existence from <code>pg_database</code>.</p>
<p>Note that database creation requires the CREATEDB privilege. See PostgreSQL <a href="https://www.postgresql.org/docs/current/static/sql-createdatabase.html">CREATE DATABASE</a> documentation for more.</p>

			      	</div>

			      	<hr />

			      	<nav class="related-links">
				        <span>
				        	<strong>Previous: </strong><a href="/marten/">Marten</a>

				        </span>
				        <span class="pull-right">

				        	<strong>Next: </strong><a href="/marten/documentation">Documentation</a>

				        </span>
			      	</nav>

		      </div><!--/right-->
		  	</div><!--/row-->
		</div><!--/container-->


    </body>


    <foot>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/marten/content/prism.js"></script>
        <script type="text/javascript" src="/marten/content/sidebar.js"></script>
        <script type="text/javascript" src="/marten/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    //alert(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }



}); 

</script>
    </foot>
</html>

